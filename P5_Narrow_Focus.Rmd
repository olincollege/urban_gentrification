---
title: "| Data Science With an Eye Towards Sustainability    \n| P5: Narrowing Your Project Topic\n"
author: "Madie Tong, Antoinette Tan, Cara Mulrooney, Grant Miner, Merwan Yeditha"
output:
  bookdown::html_document2:
    split_by: none
    toc: no

---


Each group should hand in one html document for the following exercises. Throughout the exercises, keep in mind that your research topics, questions, and data might evolve throughout the course of the project. This checkpoint is simply a first step in narrowing these down.

\

# Names & Workflow

List all group members. Discuss a plan for completing this assignment. How will you put together your shared Rmd? How will you divide the work? When will you meet to work on the assignment? Write this down in your Rmd.

Also, write down your GitHub repository.

Our group members are Madie Tong, Antoinette Tan, Cara Mulrooney, Grant Miner, and Merwan Yeditha. We will host weekly meetings to update each other on the status of our corresponding parts of the project and co-work. If a meeting is deemed unnecessary for the week, then it may be canceled. Each member will have their own branch in the github repo to work in. If a member would like to integrate their branches work with the main branch, then another team member may review their pull request. In regards to splitting up tasks, we will discuss individual learning goals, and devy up tasks based on interest. 

Our github repository can be found here: https://github.com/olincollege/urban_gentrification.


\

# Topic & Research Questions

Following on the conversations you've already had in the preliminary brainstorming exercises, identify a common research topic of interest.

We want to investigate the intersection of neighborhood socioeconomic disparities, demographics, and available resources.

Specify two to three potential research questions that (1) are related to the topic above; and (2) you can (at least partially) answer using data.

How does the air quality compare for economically disadvantaged neighborhoods within cities?

How do changes in demographics of a county or neighborhood impact the retail geography? (including malls, high-end grocery/retail stores, etc)


\

# Connections to Sustainability

How are your research questions connected to sustainability? What are your personal learning goals related to sustainability for this project? You may wish to refer back to the [UN Sustainable Development Goals](https://sdgs.un.org/goals), the [Inner Development Goals](https://innerdevelopmentgoals.org/), and the [Engineering for One Planet](https://engineeringforoneplanet.org/wp-content/uploads/EOP_Framework_2023.pdf?), [Six Pillars of Climate Justice](https://centerclimatejustice.universityofcalifornia.edu/what-is-climate-justice/), and [Just Transition Principles](https://climatejusticealliance.org/just-transition/) frameworks. As a team, what sustainability background, analysis, and  storytellling do you want to include in the scope of your project and in your final artifacts?

Some sustainability related goals relevant to our research questions taken from the provided websites are written below. 

[UN Sustainable Development Goals](https://sdgs.un.org/goals): 

1. No Poverty
3. Good Health and Well-Being
10. Reduced Inequalities
11. Sustainable Cities and Communities 

[Just Transition Principles](https://climatejusticealliance.org/just-transition/)

Equitable Redistribution of Resources and Power
We must work to build new systems that are good for all people, and not just a few. Just Transition must actively work against and transform current and historic social inequities based on race, class, gender, immigrant status and other forms of oppression. Just Transition fights to reclaim capital and resources for the regeneration of geographies and sectors of the economy where these inequities are most pervasive.

Please see our personal learning goals below:

Cara:
I would like to gain more experience in data preprocessing in this project. This step is crucial to a faster and more efficient data analysis process and improves data quality.

Antoinette:
I would like to make effective visualizations that tell a succinct story without being too complicated.

Grant:
My goal for this project is to learn how to better find, scrape, and clean data. I also want to develop my storytelling skills through the visualizations I produce and weave them into effectively argued text.

Merwan:
Through this project, I would like to practice my skills with data cleaning and preparation as well as my ability to create useful and readable visualizations.

Madie:
My goal for this project is to gain experience with cleaning/wrangling data, as well as use visualizations to convey interesting stories with data. Particularly, I would like to work more with map data or spatial visualization.


As a team, we want to spend most of our time on the analysis and storytelling aspects of our project, ensuring that our final artifacts are clear, easy to understand, and informative.

\

# Data

Identify the data sets you will use to explore the research questions above. These data sets may already be in csv form, you may acquire them (e.g., scraped with rvest, via public API, or from an SQL database), or you may plan on collecting some extra data. For each data set, summarize the following:

- data source
- data description - what's being measured?
- data limitations (eg: are the data recent? do they contain all variables you might want?)
- data dimensions - how much data do you have?
- how might the data be joined with other data you have?


[StreetEasy Data Dashboard ](https://streeteasy.com/blog/data-dashboard/?agg=Median&metric=Asking%20Rent&type=Rentals&bedrooms=Any%20Bedrooms&property=Any%20Property%20Type&minDate=2010-01&maxDate=2024-01&area=Flatiron,Brooklyn%20Heights)
- Measures rents and other metrics for a variety of subsets of properties from 2010 to 2024 on a monthly resolution
- There are a few missing data points and these are averages over neighborhoods; the raw data is not available. 
- 198 observations (neighborhoods) by 173 variables (170 months)
- Could be interesting to compare with demographic or development data



NYC Gentrification Data https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/O56ZMB
- Contains information on average housing prices, income, age/education demographics, and non-white hispanic population of different tracts of land across NYC
- Data ends at 2016, so it is not the most up to date and may be missing other trends that have developed in the last decade and has a baseline of 2000 rather than annual data
- 28 variables across 2095 observations (tracts of land)
- This data could serve as an index for mapping pieces of land to gentrification and demographics information, joining this with info on businesses and transport access
 
Air quality database
	[https://www.who.int/publications/m/item/who-ambient-air-quality-database-(update-jan-2024)]
- data on ground measurements of annual mean concentrations of nitrogen dioxide (NO2), particulate matter of a diameter equal or smaller than 10 μm (PM10) or equal or smaller than 2.5 μm (PM2.5) which aim at representing an average for the city or town as a whole, rather than for individual stations. Both groups of pollutants originate mainly from human activities related to fossil fuel combustion.
- Data is from Jan 2024, so it is very recent. A limitation might be how broad the data is in terms of location.
- 40099x20
- Can join it based on city/location


EPA Air Quality Data
https://www.epa.gov/outdoor-air-quality-data/download-daily-data

- Daily data on air quality from different counties/states.
- Limitation might be multiple different types of monitoring devices and procedures. 
- Depends on the parameters chosen
- Can join it based on city/location


\

# Research Question 1

Restate research question 1. Construct 3-4 relevant visualizations that provide insight on / help answer this question and piece these together to tell a short story. For each visualization, 1-2 sentences will suffice.

How does the air quality compare for economically disadvantaged neighborhoods within cities?

Cara: 
```{r}
library(readxl)
library(here)
file <- "who_ambient_air_quality_database_version_2024_(v6.1).xlsx" 
air_quality_assessment <- read_excel(here("data",file), sheet="Update 2024 (V6.1)")
```

```{r}
library(dplyr)
library(ggplot2)
area_air_quality <- air_quality_assessment %>%
  filter(city == "New York Newark Jersey City NY NJ PA/USA") %>%
  mutate(pm10_concentration = as.numeric(pm10_concentration))

area_air_quality2 <- air_quality_assessment %>%
  filter(city == "Detroit Warren Dearborn MI/USA") %>%
  mutate(pm10_concentration = as.numeric(pm10_concentration))

area_air_quality3 <- air_quality_assessment %>%
  filter(city == "Cleveland Elyria OH/USA") %>%
  mutate(pm10_concentration = as.numeric(pm10_concentration))

combined_data <- rbind(area_air_quality, area_air_quality2, area_air_quality3)

combined_plot <- ggplot(combined_data, aes(x = year, y = pm10_concentration, color = city)) +
  geom_line() +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.9)) +
  xlab("Year") + ylab("PM10 Concentration (ug/m^3)") + 
  ggtitle("Average PM10 Concentration 2010-2021") +
  scale_color_manual(values = c("red", "blue", "green"))  # Optional: set line colors

print(combined_plot)
```
Over the last ten years, the PM10 concentration in the air of New York, New Jersey, and Pennsylvania has dramatically decreased. The PM10 concentration in the air of economically disadvantaged areas of the country, including Cleveland, OH and Detroit, MI, have slightly decreased over time, but not nearly as drastically as that of NY, NJ, and PA. As of 2021, both of these economically disadvantaged areas have a PM10 concentration of over 20 ug/m^3.

Madie:
```{r}
library(stringr)
library(readr)

cityairMessy <- read_csv(here("data","cali_air_county_2022.csv"))

cityairMessy2 <- data.frame( # cutting first few rows that have weird names
  state = cityairMessy[3:nrow(cityairMessy),1], # cutting off first two rows of col, which doesnt contain the correct data values
  county = cityairMessy[3:nrow(cityairMessy),2],
  y2010_pop = cityairMessy[3:nrow(cityairMessy),3],
  PM2.5_24hr = cityairMessy[3:nrow(cityairMessy),12]
)
cityairMessy2 <- # renaming columns and removing ND and IN type data
  cityairMessy2 %>%
  rename(state = Air.Quality.Statistics.by.County..2022,
   	county = ...2,
   	population = ...3,
   	pm2.5_24hr = ...12) %>%
  filter(pm2.5_24hr != "ND", pm2.5_24hr != "IN") # filtering out thr no datas and insufficient datas

# putting everything in lowercase so that it matches up w county map_data
cityairMessy2$county <- tolower(cityairMessy2$county)
cityairMessy2$state <- tolower(cityairMessy2$state)

# removing the word county to make them align, and saving only cali data
cityairMessy2$county <- str_remove(cityairMessy2$county, "county")
cali_air <- filter(cityairMessy2, state == "california") %>%
  mutate(county = trimws(county)) # trims the white space that comes after the word so that it actually aligns

# grabbing county map data
counties <- map_data("county")
counties = filter(counties, region == "california")

# joining two datasets together by county to make plotting easier
counties = counties %>%
  left_join(cali_air %>% select(county, pm2.5_24hr), by = c("subregion" = "county"))
counties$pm2.5_24hr[is.na(counties$pm2.5_24hr)]=0 # anything with NA is labelled w 0 instead
 
# plotting counties and filling color based on pm level
ggplot(counties, aes(x = long, y = lat)) +
  geom_polygon(aes(fill = pm2.5_24hr, group = subregion)) +
  labs(title="Particulate Matter Levels of California by County", caption="Note that counties with PM level of 0 have insufficient data.")+
  scale_fill_discrete(name = "24hr Concentration of PM 2.5(µg/m^3)")
```

Using Air Quality data provided by the US Environmental Protection Agency, a visualization of the PM (particulate matter) 2.5 concentration in the state of California as of May 2023 is shown based on county. Counties that lie inland and in the center of the state have the highest concentration of particulate matter 2.5, citing values of 35 µg/m^3 and above compared to a typical concentration of 12 µg/m^3. In contrast, counties lining the coast have significantly lower concentrations, ranging between 13-17 µg/m^3. Counties with some of the largest percentages of population below poverty level, such as Fresno, Merced, and Tulare county, all fall within the count of counties with PM2.5 concentrations above 37 µg/m^3.

Antoinette:
```{r}
library(readr)
air_data <- read_csv(here("data","MA_2024_PM2_5_Air_Quality.csv"))

clean_air_data <- air_data %>% 
  select(COUNTY_CODE, STATE_CODE, Date, "Daily Mean PM2.5 Concentration", UNITS, DAILY_AQI_VALUE, COUNTY, SITE_LATITUDE, SITE_LONGITUDE) %>% 
  mutate(region = as.double(paste(STATE_CODE, COUNTY_CODE, sep = ""))) %>% 
  group_by(region) %>% 
  summarize(value = mean(DAILY_AQI_VALUE)) 
```

```{r}
library(choroplethr)   # another option to make choropleths
library(RColorBrewer)  # for color palettes
library(choroplethrMaps)


county_choropleth(clean_air_data, state_zoom="massachusetts")+
 scale_fill_manual(values = rev(brewer.pal(8,"RdBu")))+ labs(fill=element_blank(),title="Mean AQI Value 2024 by Massachusetts County")
```

The air quality of Massachusetts in terms of AQI is pretty low on average with daily AQIs ranging from 14.1 to 26.3 on average. Regions of high AQI that stand out are western Massachusetts and the Boston area. 


\

# Research Question 2 (and possibly 3)

Repeat the previous exercise for your second and possibly third research questions.

How do changes in demographics of a county or neighborhood impact the retail geography? (including malls, high-end grocery/retail stores, etc)

Grant:
```{r}
estab_change <- read_csv("data/DeltaEstabCount_NYC1317.csv", show_col_types = FALSE)

ggplot(estab_change, aes(x=Category, y=PercentageChange, fill=Status))+
  geom_bar(position="dodge", stat="identity")+
  labs(title="Retail Business Count by Area Classification (2013 vs 2017)", xlabel="Yelp Category", ylabel="Percentage (%)")+
  scale_fill_discrete(name="Income Status", labels=c("Gentrifying", "Poor, Non-gentrifying", "Rich"))
```
In New York City, there is identifiable change in the retail landscape in relation to whether a community is being gentrified. There is not consistency across sectors, but there is statistically significant difference in at least the expansion of convenience stores between gentrifying and poor areas, and also statistically significant difference in the expansion of convenience, fast-food, grocery, hair, and restaurant businesses between gentrifying and rich areas.

Merwan:
```{r, cache=TRUE}
library(readr)
library(dplyr)
zap <- read_csv(here("data", "Zoning_Application_Portal__ZAP__-_BBL_20240331.csv"))


thing <- zap %>% mutate("Year"=as.numeric(substr(zap$validated_date, 7,10)))

ggplot(thing, aes(x=validated_borough)) +
  geom_bar() +
  facet_wrap(~Year)
```

This code uses a dataset of all of the zoning applications throughout the boroughs of NYC. This can give us a good idea of where the new building projects are located. Visualizing this data over the years shows that Manhattan and Brooklyn seem to get the most new building projects which shows the amount of building development in those areas. In Brooklyn’s case, it might be interesting to look back further and see if the gentrification of the area has led to more investment and building development in the area.

```{r}
library(leaflet)
wholefoods <- read_csv(here("data","wholefoodsny.csv"))
leaflet(data=wholefoods) %>% 
  addTiles() %>% 
  addMarkers(lng=~long,
             lat=~lat)
```

A quick map of all of the Whole Foods locations in New York--a bit of a play on the fact that Whole Foods in particular has been thought of as a symbol of gentrification of an area, but it is notable that the only Whole Foods locations in the city outside of Manhattan are in Brooklyn.


\

# Next Steps

Identify next steps in your analysis. Do you need additional data? Do you need to do more cleaning or wrangling? How might you narrow your research questions/hypotheses? What additional visualizations would be helpful? 

The following is a list of possible next steps in our analysis:
- Narrow our research question to a certain state or city
- Visualize how gentrification has changed over time
- Obtain more granular data on specific regions within counties


\

# Contributions

Summarize each group member's specific contributions to this checkpoint assignment.

Everyone helped brainstorm all of the questions. The data visualizations were split up by group member- each visualization is labeled with who made it. 
