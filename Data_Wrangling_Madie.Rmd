---
title: "Data_Wrangling"
author: "Madie Tong"
date: "2024-04-25"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(stringr)
library(tidyverse)
library(tidycensus)
library(tmap)
library("readxl")
library(ggmap)
knitr::opts_chunk$set(echo = TRUE)
```

Addresses of Properties Qualified for 421a Tax Exemption
[link](https://www.nyc.gov/site/finance/property/benefits-421a.page)
```{r}
properties_421a_22_23 <- read_xlsx("/home/mtong1/Downloads/421a_2023_brooklyn.xlsx")


clean_prop <-
  properties_421a_22_23 %>%
  mutate(Address = str_to_title(Address)) %>%                                 # Converting addresses into better, parse-able format 
  mutate(full_addy = paste(Address, ZIP_CODE, sep = ", Brooklyn, NY ")) %>%   # Completing each address and adding zip code
  filter(YEAR_BUILT > 0) %>%                                                  # Filtering rows without proper years
  distinct(YEAR_BUILT, full_addy, .keep_all = T) %>%                          # taking out rows with duplicate pairs of year and addresses
  arrange(desc(YEAR_BUILT))
```
Number of Units Qualified for Tax Exemptions per Borough
[link](https://furmancenter.org/files/publications/The_Role_of_421-a_Final.pdf)
*This data frame was manually created using values taken from the above article in Figure (BLANK) on page (BLANK).*
```{r}
residential_developments = data.frame(
  tax_type = c("421a", "421a","421a","421a","421a","420c", "420c", "420c", "420c", "420c", "other", "other", "other", "other", "other", "none reported", "none reported", "none reported", "none reported", "none reported"),
  borough = c("bronx", "brooklyn", "manhattan", "queens", "staten_island","bronx", "brooklyn", "manhattan", "queens", "staten_island","bronx", "brooklyn", "manhattan", "queens", "staten_island","bronx", "brooklyn", "manhattan", "queens", "staten_island"),
  units = c(9216, 49654, 33791, 23573, 808, 15617, 6811, 3575, 3401, 292, 771, 2169, 1665, 2572, 140, 693, 7840, 7033, 2254, 30)
)
```
Total Low Income Units 
[link](https://furmancenter.org/neighborhoods/view/brooklyn)
```{r}
borough_low_income_units <- read_csv("/home/mtong1/Downloads/focus_databrooklyn.csv", show_col_types = FALSE)
spec(borough_low_income_units)


borough_low_income_units <- 
  borough_low_income_units %>%
# separating borough and borough number to write out boroughs in name 
  separate(col=Geography, into = c("borough", "borough num"), sep=" ") %>%
  mutate(borough = recode(borough, BX = 'Bronx', MN = "Manhattan", QN = "Queens", SI = "Staten Island", BK = "Brooklyn")) %>%
# separating number of units per column from the percentage 
  separate(col=market_rate_units, into = c("market_rate_units", "market_rate_units_percentage"), sep=" ") %>%
  separate(col=mi_mod_units, into = c("mi_mod_units", "mi_mod_units_percentage"), sep=" ") %>%
  separate(col=low_income_units, into = c("low_income_units", "low_income_units_percentage"), sep=" ") %>%
  separate(col=unknown_units, into = c("unknown_units", "unknown_units_percentage"), sep=" ") %>%
# taking out commas in unit numbers for parsing, converting to doubles for math operations 
  mutate(low_income_units = as.double(gsub(",","",low_income_units)),
         mi_mod_units = as.double(gsub(",","", mi_mod_units)),
         market_rate_units = as.double(gsub(",","", market_rate_units)),
         unknown_units = as.double(gsub(",","", unknown_units)))


summed_borough_units <- 
  borough_low_income_units %>%
# summing over units per borough for each category of unit
  group_by(borough)%>% 
  mutate(total_low_income =sum(low_income_units),
         total_mi_mod = sum(mi_mod_units),
         total_market = sum(market_rate_units),
         total_unknown = sum(unknown_units)) %>%
# removing non-useful columns
  select(borough, total_mi_mod, total_low_income, total_market, total_unknown) %>%
# removing duplicate rows 
  distinct(borough, total_mi_mod, total_low_income, total_market, total_unknown, .keep_all = T) %>%
  pivot_longer(!borough, names_to = "income_type", values_to = "total")


residential_developments <- 
  residential_developments %>%
  mutate(borough = gsub("_", " ", borough)) %>% # removing underscore from staten island values
  mutate(borough = str_to_title(borough)) %>% # converting first letters to uppercase for ease of joining datasets
  filter(tax_type == "421a")


# joining two datasets
units_low_income_421a <- merge(summed_borough_units, residential_developments, by=c("borough")) %>%
  rename(units_421a = units) %>%
  select(!tax_type) %>%
  filter(income_type == "total_low_income") %>%
  select(!income_type) %>%
  pivot_longer(!borough, names_to = "unit_type", values_to = "value") %>%
  mutate(unit_type = recode(unit_type, total="Total Low Income Units", units_421a = "Total 421a Exempt Units"))
```
Median Gross Rent 
[link](https://furmancenter.org/neighborhoods/view/brooklyn)
```{r}
median_rent <- read_csv("/home/mtong1/Downloads/median_rent_data.csv")


borough_median_rent <-
  median_rent %>%
  filter(Level == "Boro") %>%
  select(!Geography) %>%
  select(!Level) %>%
  pivot_longer(!Name, names_to = "year", values_to = "value") %>%
# removing $ and , from price value for parsing
  mutate(value = gsub(",","", value)) %>%
  mutate(value = gsub("\\$", "", value))


brooklyn_median_rent <-
  median_rent %>%
# separating borough num and borough to select only brooklyn numbers
  separate(col=Geography, into = c("borough", "borough_num"), sep=" ") %>%
  filter(!is.na(borough_num), borough == "BK") %>%
  select(!borough) %>%
  select(!Level) %>%
  select(!borough_num) %>%
  pivot_longer(!Name, names_to = "year", values_to = "rent") %>%
  mutate(rent=gsub("\\$", "", rent)) %>%
  mutate(rent=as.double(gsub(",", "", rent)))
```
